<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd" default-menu-include="false" standalone="true">

    <parameter name="envioId"/>
    <parameter name="fiscalTaxDocumentId"/>

    <actions>
        <if condition="envioId == null &amp;&amp; fiscalTaxDocumentId == null">
            <return error="true" message="Need to specify either envioId or fiscalTaxDocumentId"/>
        </if>
        <entity-find entity-name="mchile.dte.DteEnvioAndFiscalTaxDocument" list="envioAndDocList">
            <econdition field-name="envioId" ignore-if-empty="true"/>
            <econdition field-name="fiscalTaxDocumentId" ignore-if-empty="true"/>
        </entity-find>
    </actions>
    <widgets>
        <form-list name="DteEnvioAndFiscalTaxDocumentList" list="envioAndDocList">
            <field name="envioId"><default-field><link url="../FindEnvio" parameter-map="[envioId:envioId]" text="${envioId}"/></default-field></field>
            <field name="envioTypeEnumId"><default-field><display-entity entity-name="moqui.basic.Enumeration"/></default-field></field>
            <field name="envioStatusId"><default-field title="Status Envio"><display-entity entity-name="moqui.basic.StatusItem"/></default-field></field>
            <field name="envioTrackId"><default-field><display/></default-field></field>
            <field name="emailMessageId"><default-field><display/></default-field></field>
            <field name="rutEmisor"><default-field><display/></default-field></field>
            <field name="rutReceptor"><default-field><display/></default-field></field>
            <field name="fiscalTaxDocumentId"><default-field><hidden/></default-field></field>
            <field name="fiscalTaxDocumentTypeEnumId"><default-field><display-entity entity-name="moqui.basic.Enumeration"/></default-field></field>
            <field name="fiscalTaxDocumentNumber">
                <header-field title="Folio"/>
                <conditional-field condition="!(issuerPartyId in filterOrgIds)">
                    <link url="../DTETerceros/FindDTETerceros" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <conditional-field condition="fiscalTaxDocumentTypeEnumId in ['Ftdt-33','Ftdt-34']">
                    <link url="../FindInvoice" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <conditional-field condition="fiscalTaxDocumentTypeEnumId in ['Ftdt-60', 'Ftdt-61']">
                    <link url="../CreditNotes/FindCreditNote" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <conditional-field condition="fiscalTaxDocumentTypeEnumId in ['Ftdt-55', 'Ftdt-56']">
                    <link url="../DebitNotes/FindDebitNote" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <conditional-field condition="fiscalTaxDocumentTypeEnumId in ['Ftdt-50', 'Ftdt-52']">
                    <link url="../FindShipGuide" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <conditional-field condition="fiscalTaxDocumentTypeEnumId in ['Ftdt-39','Ftdt-41']">
                    <link url="../FindReceipt" parameter-map="[fiscalTaxDocumentId:fiscalTaxDocumentId]" text="${fiscalTaxDocumentNumber}"/>
                </conditional-field>
                <default-field><display/></default-field>
            </field>
            <field name="date"><default-field><display/></default-field></field>
            <field name="issuerPartyId"><default-field><display-entity entity-name="mantle.party.PartyDetail" text="PartyNameOnlyTemplate"/></default-field></field>
            <field name="receiverPartyId"><default-field>
                <link url="../AccountDetails" entity-name="mantle.party.PartyDetail" text="PartyNameTemplate" link-type="anchor" parameter-map="[partyId:receiverPartyId]"/>
            </default-field></field>
            <field name="sentAuthStatusId"><default-field title="Envío a SII"><display-entity entity-name="moqui.basic.StatusItem"/></default-field></field>
            <field name="sentRecStatusId"><default-field title="Envío a Receptor"><display-entity entity-name="moqui.basic.StatusItem"/></default-field></field>
            <columns>
                <column><field-ref name="envioId"/><field-ref name="envioTypeEnumId"/></column>
                <column><field-ref name="envioStatusId"/></column>
                <column><field-ref name="envioTrackId"/><field-ref name="emailMessageId"/></column>
                <column><field-ref name="rutEmisor"/><field-ref name="rutReceptor"/></column>
                <column><field-ref name="fiscalTaxDocumentTypeEnumId"/><field-ref name="fiscalTaxDocumentNumber"/></column>
                <column><field-ref name="date"/></column>
                <column><field-ref name="issuerPartyId"/><field-ref name="receiverPartyId"/></column>
            </columns>
        </form-list>
    </widgets>
</screen>
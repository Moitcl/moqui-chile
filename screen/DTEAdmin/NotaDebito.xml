<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns=""
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        menu-image="glyphicon glyphicon-shopping-cart" menu-image-type="icon" default-menu-title="Nota de Crédito"
        default-menu-index="30">
    <transition name="genNotaCredito">
        <actions>
            <service-call name="mchile.DTEServices.genNotaCredito#Return" in-map="[returnId:returnId, dteTypeEnumId:'61']"/>
        </actions>
        <default-response url="."/>
    </transition>
    <actions>
        <!--entity-find entity-name="tfpos.InvoiceAndFiscalTaxDocument" list="invoices"-->
        <entity-find entity-name="mantle.order.return.ReturnHeader" list="returnsList">
            <search-form-inputs default-order-by="-entryDate"/>
            <!--econdition field-name="folio" operator="is-null"/-->
        </entity-find>
    </actions>
    <widgets>
        <form-list name="ReturnsForm" list="returnsList" header-dialog="true" saved-finds="true" show-csv-button="true" transition="genNotaCredito">
            <row-actions>
                <!-- Encontrar username -->
                <service-call name="mantle.party.ContactServices.get#PrimaryEmailAddress" in-map="[partyId:customerPartyId]" out-map="context"/>
                <set field="username" from="emailAddress"/>

                <!-- Encontrar método de pago -->
                <entity-find-one entity-name="mantle.account.method.PaymentMethod" value-field="paymentMethodField">
                    <select-field field-name="paymentMethodTypeEnumId"/>
                </entity-find-one>
                <set field="paymentMethodTypeEnumId" from="paymentMethodField.paymentMethodTypeEnumId"/>

            </row-actions>
            <field name="returnId">
                <header-field title="Invoice ID" show-order-by="true"><text-find/></header-field>
                <default-field><display/></default-field>
            </field>
            <field name="statusId">
                <header-field title="Status" show-order-by="true"><text-find/></header-field>
                <default-field><display/></default-field>
            </field>

            <field name="paymentMethodTypeEnumId">
                <header-field title="Método de Pago" show-order-by="false">
                    <drop-down allow-empty="true" allow-multiple="true">
                        <entity-options key="${enumId}">
                            <entity-find entity-name="moqui.basic.Enumeration">
                                <econdition field-name="enumTypeId" value="Type"/>
                            </entity-find>
                        </entity-options>
                    </drop-down>
                </header-field>
                <default-field>
                    <display-entity entity-name="moqui.basic.Enumeration"/>
                </default-field>
            </field>

            <field name="genNotaCreditoForm"><default-field title="Generar Nota de Crédito"><submit/></default-field></field>
        </form-list>
    </widgets>
</screen>
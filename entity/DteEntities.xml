<?xml version="1.0" encoding="UTF-8"?>
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-3.xsd">

    <entity entity-name="FiscalTaxDocument" package="mchile.dte">
        <field name="fiscalTaxDocumentId" type="id" is-pk="true"/>
        <field name="issuerPartyId" type="id" not-null="true" enable-audit-log="update"/>
        <field name="issuerPartyIdTypeEnumId" type="id" not-null="true" default="PtidNationalTaxId"/>
        <field name="issuerPartyIdValue" type="text-medium" not-null="true" create-only="true"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="id" not-null="true" create-only="true"/>
        <field name="fiscalTaxDocumentNumber" type="number-integer" not-null="true" create-only="true"/>
        <field name="statusId" type="id" enable-audit-log="update"/>
        <field name="sentAuthStatusId" type="id" enable-audit-log="update"/>
        <field name="sentRecStatusId" type="id" enable-audit-log="update"/>
        <field name="receiverPartyId" type="id" enable-audit-log="update"/>
        <field name="receiverPartyIdTypeEnumId" type="id" default="PtidNationalTaxId"/>
        <field name="receiverPartyIdValue" type="text-medium" enable-audit-log="update"/>
        <field name="invoiceId" type="id" enable-audit-log="update"/>
        <field name="shipmentId" type="id" enable-audit-log="update"/>
        <field name="trackId" type="id" enable-audit-log="update"><description>TrackId devuelto por SII al enviar documentos</description></field>
        <field name="date" type="date-time" default="ec.user.nowTimestamp"/>
        <field name="authComment" type="text-very-long" enable-audit-log="true"/>
        <field name="factoringStatusId" type="id" enable-audit-log="true"/>
        <field name="lastFactoringCheckDate" type="date-time"/>
        <field name="lastPortalMipymeFetchAttemptDate" type="date-time"/>
        <field name="signerPartyIdValue" type="id"><description>RUT Firmante</description></field>
        <field name="formaPagoEnumId" type="id"/>
        <relationship type="many" related="mantle.party.PartyIdentification" fk-name="fiscalTaxDocumentIssuerPartyIdntfctn" short-alias="issuerPartyIdentification">
            <key-map field-name="issuerPartyId" related="partyId"/>
            <key-map field-name="issuerPartyIdTypeEnumId" related="partyIdTypeEnumId"/>
            <key-map field-name="issuerPartyIdValue" related="idValue"/>
        </relationship>
        <relationship type="many" related="mantle.party.PartyIdentification" fk-name="fiscalTaxDocumentReceiverPartyIdntfctn" short-alias="receiverPartyIdentification">
            <key-map field-name="receiverPartyIdTypeEnumId" related="partyIdTypeEnumId"/>
            <key-map field-name="receiverPartyIdValue" related="idValue"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" short-alias="documentType" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.StatusItem" title="FiscalTaxDocumentStatus" short-alias="status">
            <key-map field-name="statusId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.StatusItem" title="FiscalTaxDocumentSentAuth" short-alias="authStatus">
            <key-map field-name="sentAuthStatusId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.StatusItem" title="FiscalTaxDocumentSentRec" short-alias="recStatus">
            <key-map field-name="sentRecStatusId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.StatusItem" title="FiscalTaxDocumentFactoring" short-alias="factoringStatus">
            <key-map field-name="factoringStatusId"/>
        </relationship>
        <relationship type="one" related="mantle.account.invoice.Invoice">
            <key-map field-name="invoiceId"/>
        </relationship>
        <relationship type="one" related="mantle.shipment.Shipment">
            <key-map field-name="shipmentId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" short-alias="partyIdentificationType" title="PartyIdType">
            <key-map field-name="issuerPartyIdTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" short-alias="formaPago" title="FiscalTaxDocumentFormaPago">
            <key-map field-name="formaPagoEnumId"/>
        </relationship>
        <index name="FiscalTaxDocumentIssuerNumber" unique="true">
            <index-field name="issuerPartyIdValue"/>
            <index-field name="fiscalTaxDocumentTypeEnumId"/>
            <index-field name="fiscalTaxDocumentNumber"/>
        </index>

        <seed-data>
            <moqui.basic.StatusType statusTypeId="FiscalTaxDocumentSentAuth" description="Fiscal Tax Document Sent to Tax Authority"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-NotSentAuth" statusCode="0" description="DTE not sent"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-SentAuthUnverified" statusCode="1" description="DTE sent waiting for verification"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-SentAuthAccepted" statusCode="2" description="DTE sent and accepted"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-SentAuthRejected" statusCode="3" description="DTE sent and rejected"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-SentAuthAcceptedWithDiscrepancies" statusCode="4" description="DTE accepted with discrepancies"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentAuth" statusId="Ftd-SendAuthFailed" statusCode="5" description="DTE failed to send"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotSentAuth" toStatusId="Ftd-SentAuthUnverified"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentAuthUnverified" toStatusId="Ftd-SentAuthAccepted"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentAuthUnverified" toStatusId="Ftd-SentAuthAcceptedWithDiscrepancies"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentAuthUnverified" toStatusId="Ftd-SendAuthFailed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SendAuthFailed" toStatusId="Ftd-SentAuthUnverified"/>

            <moqui.basic.StatusType statusTypeId="FiscalTaxDocumentSentRec" description="Fiscal Tax Document Sent to Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-NotSentRec" statusCode="0" description="DTE not sent to Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-SentRec" statusCode="2" description="DTE sent to Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-SentRecFailed" statusCode="2" description="DTE failed sent to Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-ReceiverAck" statusCode="3" description="DTE acknowledged by Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-ReceiverAccept" statusCode="4" description="DTE accepted by Receiver"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentSentRec" statusId="Ftd-ReceiverReject" statusCode="5" description="DTE rejected by Receiver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotSentRec" toStatusId="Ftd-SentRec"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotSentRec" toStatusId="Ftd-ReceiverAck"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotSentRec" toStatusId="Ftd-SentRecFailed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentRec" toStatusId="Ftd-ReceiverAck"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentRec" toStatusId="Ftd-ReceiverAccept"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-SentRec" toStatusId="Ftd-ReceiverReject"/>

            <moqui.basic.StatusType statusTypeId="FiscalTaxDocumentStatus" description="Fiscal Tax Document Status"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentStatus" statusId="Ftd-NotIssued" statusCode="0" description="DTE not issued"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentStatus" statusId="Ftd-Issued" statusCode="1" description="DTE already issued"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentStatus" statusId="Ftd-Cancelled" statusCode="2" description="DTE Cancelled (anulada)"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentStatus" statusId="Ftd-Blocked" statusCode="3" description="DTE not to be issued"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentStatus" statusId="Ftd-LocallyUnknown" statusCode="4" description="DTE not known locally but present at SII"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotIssued" toStatusId="Ftd-Issued"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotIssued" toStatusId="Ftd-Cancelled"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotIssued" toStatusId="Ftd-Blocked"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-Blocked" toStatusId="Ftd-NotIssued"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-LocallyUnknown" toStatusId="Ftd-Issued"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-LocallyUnknown" toStatusId="Ftd-Cancelled"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-LocallyUnknown" toStatusId="Ftd-NotIssued"/>

            <moqui.basic.StatusType statusTypeId="FiscalTaxDocumentFactoring" description="Fiscal Tax Document Factoring"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentFactoring" statusId="Ftd-TransferUnknown" statusCode="0" description="Unknown whether DTE has been transferred to a factoring"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentFactoring" statusId="Ftd-NotTransferred" statusCode="1" description="DTE has not been transferred to a factoring"/>
            <moqui.basic.StatusItem statusTypeId="FiscalTaxDocumentFactoring" statusId="Ftd-Transferred" statusCode="2" description="DTE has been transferred to a factoring"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-TransferUnknown" toStatusId="Ftd-NotTransferred"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-NotTransferred" toStatusId="Ftd-Transferred"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftd-Transferred" toStatusId="Ftd-NotTransferred"/>

            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentAggr" description="Fiscal Tax Documents"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentAggr" enumId="Ftdt-Facturas" description="Facturas"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentAggr" enumId="Ftdt-Boletas" description="Boletas"/>

            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentType" description="Fiscal Tax Documents"/>
            <!-- Source: http://www.sii.cl/factura_electronica/formato_iecv.pdf, http://www.sii.cl/factura_electronica/formato_dte.pdf
             -->
            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentType" description="Fiscal Tax Documents"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-DTE" description="Documento Tributario Electrónico"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-DT" description="Documento Tributario (soporte papel)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-29" enumCode="29" sequenceNum="29" parentEnumId="Ftdt-DT" description="Factura de Inicio"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-30" enumCode="30" sequenceNum="30" parentEnumId="Ftdt-DT" description="Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-32" enumCode="32" sequenceNum="32" parentEnumId="Ftdt-DT" description="Factura de Ventas y Servicios no Afectos a IVA"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-33" enumCode="33" sequenceNum="33" parentEnumId="Ftdt-DTE" description="Factura Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-34" enumCode="34" sequenceNum="34" parentEnumId="Ftdt-DTE" description="Factura Exenta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-35" enumCode="35" sequenceNum="35" parentEnumId="Ftdt-DT" description="Boleta"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-38" enumCode="38" sequenceNum="38" parentEnumId="Ftdt-DT" description="Boleta Exenta"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-39" enumCode="39" sequenceNum="39" parentEnumId="Ftdt-DTE" description="Boleta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-40" enumCode="40" sequenceNum="40" parentEnumId="Ftdt-DT" description="Liquidación Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-41" enumCode="41" sequenceNum="41" parentEnumId="Ftdt-DTE" description="Boleta Exenta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-43" enumCode="43" sequenceNum="43" parentEnumId="Ftdt-DTE" description="Liquidación Factura Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-45" enumCode="45" sequenceNum="45" parentEnumId="Ftdt-DT" description="Factura de Compra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-46" enumCode="46" sequenceNum="46" parentEnumId="Ftdt-DTE" description="Factura de Compra Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-50" enumCode="50" sequenceNum="50" parentEnumId="Ftdt-DT" description="Guía de Despacho"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-52" enumCode="52" sequenceNum="52" parentEnumId="Ftdt-DTE" description="Guía de Despacho Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-55" enumCode="55" sequenceNum="55" parentEnumId="Ftdt-DT" description="Nota de Débito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-56" enumCode="56" sequenceNum="56" parentEnumId="Ftdt-DTE" description="Nota de Débito Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-60" enumCode="60" sequenceNum="60" parentEnumId="Ftdt-DT" description="Nota de Crédito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-61" enumCode="61" sequenceNum="61" parentEnumId="Ftdt-DTE" description="Nota de Crédito Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-101" enumCode="101" sequenceNum="101" parentEnumId="Ftdt-DT" description="Factura de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-102" enumCode="102" sequenceNum="102" parentEnumId="Ftdt-DT" description="Factura de venta exenta a zona franca primaria"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-103" enumCode="103" sequenceNum="103" parentEnumId="Ftdt-DT" description="Liquidación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-104" enumCode="104" sequenceNum="104" parentEnumId="Ftdt-DT" description="Nota de débito de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-105" enumCode="105" sequenceNum="105" parentEnumId="Ftdt-DT" description="Boleta liquidación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-106" enumCode="106" sequenceNum="106" parentEnumId="Ftdt-DT" description="Nota de Crédito de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-108" enumCode="108" sequenceNum="108" parentEnumId="Ftdt-DT" description="SRF Solicitud de Registro de Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-109" enumCode="109" sequenceNum="109" parentEnumId="Ftdt-DT" description="Factura a turista"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-110" enumCode="110" sequenceNum="110" parentEnumId="Ftdt-DTE" description="Factura de Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-111" enumCode="111" sequenceNum="111" parentEnumId="Ftdt-DTE" description="Nota de Débito Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-112" enumCode="112" sequenceNum="112" parentEnumId="Ftdt-DTE" description="Nota de Crédito Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-801" enumCode="801" sequenceNum="801" parentEnumId="Ftdt-DT" description="Orden de Compra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-802" enumCode="802" sequenceNum="802" parentEnumId="Ftdt-DT" description="Nota de Pedido"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-803" enumCode="803" sequenceNum="803" parentEnumId="Ftdt-DT" description="Contrato"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-804" enumCode="804" sequenceNum="804" parentEnumId="Ftdt-DT" description="Resolución"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-805" enumCode="805" sequenceNum="805" parentEnumId="Ftdt-DT" description="Proceso ChileCompra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-806" enumCode="806" sequenceNum="806" parentEnumId="Ftdt-DT" description="Ficha ChileCompra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-807" enumCode="807" sequenceNum="807" parentEnumId="Ftdt-DT" description="DUS"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-808" enumCode="808" sequenceNum="808" parentEnumId="Ftdt-DT" description="B/L (Conocimiento de embarque)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-809" enumCode="809" sequenceNum="809" parentEnumId="Ftdt-DT" description="AWB (Air Will Bill)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-810" enumCode="810" sequenceNum="810" parentEnumId="Ftdt-DT" description="MIC/DTA"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-811" enumCode="811" sequenceNum="811" parentEnumId="Ftdt-DT" description="Carta de Porte"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-812" enumCode="812" sequenceNum="812" parentEnumId="Ftdt-DT" description="Resolución del SNA donde califica Servicios de Exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-813" enumCode="813" sequenceNum="813" parentEnumId="Ftdt-DT" description="Pasaporte"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-814" enumCode="814" sequenceNum="814" parentEnumId="Ftdt-DT" description="Certificado de Depósito Bolsa Prod. Chile"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-815" enumCode="815" sequenceNum="815" parentEnumId="Ftdt-DT" description="Vale de Prenda Bolsa Prod. Chile"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-901" enumCode="901" sequenceNum="901" parentEnumId="Ftdt-DT" description="Factura de Ventas a Empresas del Territorio Preferencial"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-902" enumCode="902" sequenceNum="902" parentEnumId="Ftdt-DT" description="Conocimiento de Embarque (Marítimo o aéreo)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-903" enumCode="903" sequenceNum="903" parentEnumId="Ftdt-DT" description="Documento único de Salida (DUS)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-904" enumCode="904" sequenceNum="904" parentEnumId="Ftdt-DT" description="Factura de Traspaso (Zona Franca)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-905" enumCode="905" sequenceNum="905" parentEnumId="Ftdt-DT" description="Factura de Reexpedición"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-906" enumCode="906" sequenceNum="906" parentEnumId="Ftdt-DT" description="Boleta Venta Módulos ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-907" enumCode="907" sequenceNum="907" parentEnumId="Ftdt-DT" description="Factura Venta Módulos ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-909" enumCode="909" sequenceNum="909" parentEnumId="Ftdt-DT" description="Factura Venta Módulo ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-910" enumCode="910" sequenceNum="910" parentEnumId="Ftdt-DT" description="Solicitud Traslado Zona Franca"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-911" enumCode="911" sequenceNum="911" parentEnumId="Ftdt-DT" description="Declaración de Ingreso a Zona Franca Primaria"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-914" enumCode="914" sequenceNum="914" parentEnumId="Ftdt-DT" description="Declaración de Ingreso (DIN)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-919" enumCode="919" sequenceNum="919" parentEnumId="Ftdt-DT" description="Resumen de ventas de nacionales pasajes sin Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-920" enumCode="920" sequenceNum="920" parentEnumId="Ftdt-DT" description="Otros registros no documentados Aumenta débito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-922" enumCode="922" sequenceNum="922" parentEnumId="Ftdt-DT" description="Otros registros. Disminuye débito."/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-924" enumCode="924" sequenceNum="924" parentEnumId="Ftdt-DT" description="Resumen ventas de internacionales pasajes sin Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-LibroCompras" sequenceNum="240" description="Libro de Compras"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-LibroVentas" sequenceNum="240" description="Libro de Ventas"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-Redcompra" sequenceNum="30" description="Comprobante Redcompra válido como boleta"/>

            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentFormaPago" description="Forma de Pago in Fiscal Tax Documents"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentFormaPago" enumId="Ftdfp-Contado" enumCode="1" sequenceNum="10" description="Contado"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentFormaPago" enumId="Ftdfp-Credito" enumCode="2" sequenceNum="20" description="Crédito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentFormaPago" enumId="Ftdfp-Gratuita" enumCode="3" sequenceNum="30" description="Sin costo (entrega gratuita)"/>
        </seed-data>
    </entity>

    <entity entity-name="GuiaDespacho" package="mchile.dte">
        <field name="fiscalTaxDocumentId" type="id" is-pk="true"/>
        <field name="indTrasladoEnumId" type="id" enable-audit-log="update"><description>Sólo para guías de despacho, indica si traslado es por venta u otros motivos</description></field>
        <field name="facturaFiscalTaxDocumentId" type="id"><description>Factura emitida para guía de despacho que genera venta</description></field>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument" fk-name="GuiaDespachoFiscalTaxDocumentId"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="IndTraslado">
            <key-map field-name="indTrasladoEnumId"/>
        </relationship>
        <relationship type="one-nofk" related="mchile.dte.FiscalTaxDocument" short-alias="factura" fk-name="GuiaDespachoFacturaFiscalTaxDocumentId">
            <key-map field-name="facturaFiscalTaxDocumentId"/>
        </relationship>
    </entity>

    <view-entity entity-name="DteAndGuiaDespacho" package="mchile.dte">
        <member-entity entity-name="mchile.dte.FiscalTaxDocument" entity-alias="FTD"/>
        <member-entity entity-name="mchile.dte.GuiaDespacho" entity-alias="GD" join-from-alias="FTD" join-optional="true">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <alias-all entity-alias="FTD"/>
        <alias-all entity-alias="GD"/>
    </view-entity>

    <entity entity-name="FiscalTaxDocumentContent" package="mchile.dte">
        <field name="fiscalTaxDocumentContentId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id"/>
        <field name="fiscalTaxDocumentContentTypeEnumId" type="id"/>
        <field name="contentLocation" type="text-medium"/>
        <field name="description" type="text-long"/>
        <field name="contentDate" type="date-time" default="ec.user.nowTimestamp"/>
        <field name="userId" type="id" default="ec.user.userId"/>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="TaxDocumentContentType">
            <key-map field-name="fiscalTaxDocumentContentTypeEnumId" related="enumId"/>
        </relationship>
        <seed-data>
            <moqui.basic.EnumerationType enumTypeId="TaxDocumentContentType" description="Type of Content for a Tax Document"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-Pdf" description="Archivo PDF con la representación impresa del DTE"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-PdfCedible" description="Archivo PDF Cedible con la representación impresa del DTE"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-Xml" description="Archivo XML con la representación electrónica del DTE"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-Envio" description="Archivo XML con Envio DTE"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-RecAck" description="Aceptación de receptor del DTE"/>
            <moqui.basic.Enumeration enumTypeId="TaxDocumentContentType" enumId="Ftdct-Misc" description="Contenido adicional relacionado con el DTE"/>
        </seed-data>
    </entity>

    <entity entity-name="FiscalTaxDocumentEmailMessage" package="mchile.dte">
        <field name="fiscalTaxDocumentEmailMessageId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id"/>
        <field name="emailMessageId" type="id"/>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument"/>
        <relationship type="one" related="moqui.basic.email.EmailMessage"/>
    </entity>

    <view-entity entity-name="FiscalTaxDocumentEmailMessageDetail" package="mchile.dte">
        <member-entity entity-alias="FTDEM" entity-name="mchile.dte.FiscalTaxDocumentEmailMessage"/>
        <member-entity entity-alias="EMSG" entity-name="moqui.basic.email.EmailMessage" join-from-alias="FTDEM">
            <key-map field-name="emailMessageId"/></member-entity>
        <alias-all entity-alias="FTDEM"/><alias-all entity-alias="EMSG"/>
    </view-entity>

    <entity entity-name="Caf" package="mchile.dte">
        <field name="cafId" type="id" is-pk="true"/>
        <field name="activo" type="text-short" enable-audit-log="true"/>
        <field name="filename" type="text-medium"/>
        <field name="desde" type="number-integer"/>
        <field name="hasta" type="number-integer"/>
        <field name="razonSocial" type="text-medium"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="fechaAutorizacion" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="lastFolioUsed" type="number-integer"/>
        <field name="issuerPartyId" type="id"/>
        <field name="cafData" type="text-very-long" encrypt="true"/>
        <field name="cafFragment" type="text-long"/>
        <field name="keyType" type="text-short"/>
        <field name="publicKey" type="text-long"/>
        <field name="privateKey" type="text-long" encrypt="true"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="mantle.party.Party">
            <key-map field-name="issuerPartyId" related="partyId"/>
        </relationship>
    </entity>

    <view-entity entity-name="CafDetail" package="mchile.dte">
        <member-entity entity-alias="CAF" entity-name="mchile.dte.Caf"/>
        <alias-all entity-alias="CAF"/>
        <alias name="availableFolios" type="number-integer">
            <case><when expression="caf.last_Folio_Used is NULL">
                <complex-alias operator="+">
                    <complex-alias operator="-">
                        <complex-alias-field entity-alias="CAF" field="hasta"/>
                        <complex-alias-field entity-alias="CAF" field="desde"/>
                    </complex-alias>
                    <complex-alias expression="1"/>
                </complex-alias>
            </when><else>
                <complex-alias operator="-">
                    <complex-alias-field entity-alias="CAF" field="hasta"/>
                    <complex-alias-field entity-alias="CAF" field="lastFolioUsed"/>
                </complex-alias>
            </else></case>
        </alias>
    </view-entity>

    <!-- Entidad para guardar referencias a DTEs -->
    <entity entity-name="ReferenciaDte" package="mchile.dte" cache="never" >
        <field name="referenciaId" type="id" is-pk="true"/>
        <field name="referenciaTypeEnumId" type="id" not-null="true"><description>Tipo de referencia, determina qué campo de ID se espera tenga un valor definido</description></field>
        <field name="fiscalTaxDocumentId" type="id"><description>ID del documento que refiere a otro, debiera tener un valor si referenciaTypeEnumId == 'RefDteTypeFiscalTaxDocument'</description></field>
        <field name="invoiceId" type="id"><description>ID del documento que refiere a otro, debiera tener un valor si referenciaTypeEnumId == 'RefDteTypeInvoice'</description></field>
        <field name="shipmentId" type="id"><description>ID del documento que refiere a otro, debiera tener un valor si referenciaTypeEnumId == 'RefDteTypeShipment'</description></field>
        <field name="codigoReferenciaEnumId" type="id"/>
        <field name="razonReferencia" type="text-medium"/>
        <field name="fecha" type="date"/>
        <field name="idAdicional" type="text-medium"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="id"><description>Tipo del documento referido</description></field>
        <field name="rutEmisorFolio" type="text-short"><description>Rut del documento referido</description></field>
        <field name="folio" type="text-short"><description>Folio del documento referido</description></field>
        <relationship type="one" related="moqui.basic.Enumeration" title="ReferenciaDteType">
            <key-map field-name="referenciaTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" title="FtdCodigoReferencia" short-alias="codigoReferencia">
            <key-map field-name="codigoReferenciaEnumId"/>
        </relationship>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument" title="FiscalTaxDocumentId">
            <key-map field-name="fiscalTaxDocumentId"/>
        </relationship>
        <relationship type="one" related="mantle.account.invoice.Invoice" title="InvoiceId">
            <key-map field-name="invoiceId"/>
        </relationship>
        <relationship type="one" related="mantle.shipment.Shipment" title="ShipmentId">
            <key-map field-name="shipmentId"/>
        </relationship>
        <seed-data>
            <moqui.basic.EnumerationType enumTypeId="ReferenciaDteType" description="Tipo de Referencia de la DTE"/>
            <moqui.basic.Enumeration enumTypeId="ReferenciaDteType" enumId="RefDteTypeInvoice" description="Referencia Invoice"/>
            <moqui.basic.Enumeration enumTypeId="ReferenciaDteType" enumId="RefDteTypeFactura" description="Referencia Factura">
                <description>No se almacena en BD, se utiliza para generar una referencia en memoria al momento de generar un DTE</description>
            </moqui.basic.Enumeration>
            <moqui.basic.Enumeration enumTypeId="ReferenciaDteType" enumId="RefDteTypeFiscalTaxDocument" description="Referencia DTE"/>
            <moqui.basic.Enumeration enumTypeId="ReferenciaDteType" enumId="RefDteTypeShipment" description="Referencia Shipment"/>
            <moqui.basic.EnumerationType enumTypeId="FtdCodigoReferencia" description="Códigos de Referencia"/>
            <moqui.basic.Enumeration enumTypeId="FtdCodigoReferencia" enumId="MCHRefDteCodeAnula" sequenceNum="10" description="Anula Doc. de Referencia" enumCode="1"/>
            <moqui.basic.Enumeration enumTypeId="FtdCodigoReferencia" enumId="MCHRefDteCodeCorrigeTexto" sequenceNum="20" description="Corrige Texto de Referencia" enumCode="2"/>
            <moqui.basic.Enumeration enumTypeId="FtdCodigoReferencia" enumId="MCHRefDteCodeCorrigeMonto" sequenceNum="30" description="Corrige Montos" enumCode="3"/>
        </seed-data>
    </entity>

    <view-entity entity-name="ReferenciaDteAndFiscalCode" package="mchile.dte">
        <member-entity entity-alias="REFFAC" entity-name="mchile.dte.ReferenciaDte"/>
        <member-entity entity-alias="ENUMERATION" entity-name="moqui.basic.Enumeration" join-from-alias="REFFAC">
            <key-map field-name="fiscalTaxDocumentTypeEnumId" related="enumId"/>
        </member-entity>
        <alias-all entity-alias="REFFAC"/>
        <alias name="fiscalTaxDocumentTypeCode" field="enumCode" entity-alias="ENUMERATION"/>
    </view-entity>
    
    <view-entity entity-name="FiscalTaxDocumentAndReferencia" package="mchile.dte">
        <member-entity entity-alias="DTE" entity-name="mchile.dte.FiscalTaxDocument"/>
        <member-entity entity-alias="REFERENCE" entity-name="mchile.dte.ReferenciaDte" join-from-alias="DTE" join-optional="true">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <alias-all entity-alias="DTE"/>
        <alias-all entity-alias="REFERENCE">
            <exclude field="fiscalTaxDocumentTypeEnumId"/>
            <exclude field="invoiceId"/>
            <exclude field="shipmentId"/>
        </alias-all>
        <alias name="referenceFiscalTaxDocumentTypeEnumId" entity-alias="REFERENCE" field="fiscalTaxDocumentTypeEnumId"/>
        <alias name="referenceInvoiceId" entity-alias="REFERENCE" field="invoiceId"/>
        <alias name="referenceShipmentId" entity-alias="REFERENCE" field="shipmentId"/>
    </view-entity>

    <entity entity-name="DteEnvio" package="mchile.dte">
        <field name="envioId" type="id" is-pk="true"/>
        <field name="envioTypeEnumId" type="id" not-null="true" enable-audit-log="true"/>
        <field name="issuerPartyId" type="id"/>
        <field name="receiverPartyId" type="id"/>
        <field name="statusId" type="id" not-null="true" enable-audit-log="true"/>
        <field name="internalId" type="text-medium"/>
        <field name="lastAttempt" type="date-time"><description>Last attempt to send (if statusId is Ftde-Created) or to process (if statusId is Ftde-Received)</description></field>
        <field name="attemptCount" type="number-integer" not-null="true" default="0"/>
        <field name="rutEmisor" type="text-medium"/>
        <field name="rutReceptor" type="text-medium"/>
        <field name="registerDate" type="date-time" default="ec.user.nowTimestamp"/>
        <field name="documentLocation" type="text-medium"/>
        <field name="fileName" type="text-medium"><description>Nombre de archivo con que se recibió</description></field>
        <field name="processingParameters" type="text-medium"/>
        <field name="emailMessageId" type="id"/>
        <field name="trackId" type="text-medium" enable-audit-log="true"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="DteEnvioType">
            <key-map field-name="envioTypeEnumId" related="enumId"/>
        </relationship>
        <relationship type="one" related="mantle.party.Party" fk-name="DteEnvioIssuerPartyId">
            <key-map field-name="issuerPartyId" related="partyId"/>
        </relationship>
        <relationship type="one" related="mantle.party.Party" fk-name="DteEnvioReceiverPartyId">
            <key-map field-name="receiverPartyId" related="partyId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.StatusItem" title="DteEnvio">
            <key-map field-name="statusId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.email.EmailMessage"/>
        <seed-data>
            <moqui.basic.EnumerationType enumTypeId="DteEnvioType" description="Tipo de Envío (intercambio)"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-EnvioDte" description="Envío DTE" enumCode="EnvioDte"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-RespuestaDte" description="Respuesta a envío DTE" enumCode="RespuestaDte"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-EnvioRecibos" description="Aceptación / Acuse de Recibo que da pie a título ejecutivo de factura" enumCode="EnvioRecibo"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-ResultadoEnvio" description="Resultado Envio del SII" enumCode="ResultadoEnvio"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-EnvioBoleta" description="Envío Boleta" enumCode="EnviaBoleta"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftde-ResultadoConsumoFolios" description="Resultado Consumo de Folios" enumCode="ResultadoConsumoFolios"/>
            <moqui.basic.Enumeration enumTypeId="DteEnvioType" enumId="Ftdt-Rcof" description="Registro de Consumo de Folios" enumCode="RegistroConsumoFolios"/>
            <moqui.basic.StatusType statusTypeId="DteEnvio" description="Envío de datos de Factura Electrónica"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Created" statusCode="0" description="Envío Creado"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Sent" statusCode="1" description="Envío Enviado"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Failed" statusCode="2" description="Envío Fallido"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Received" statusCode="3" description="Envío Recibido"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Processed" statusCode="4" description="Envío Procesado"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessRejectedSchema" statusCode="5" description="Envío Rechazado por Error en Schema"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessRejectedSignature" statusCode="6" description="Envío Rechazado por Error en Firma"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessRejectedEnvelope" statusCode="7" description="Envío Rechazado por Error en Carátula"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessFailed" statusCode="8" description="Envío Procesado con falla"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-FailedAtReceiver" statusCode="9" description="Envío no procesado por receptor"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessedWithRejection" statusCode="10" description="Envío procesado y con rechazos"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-ProcessedWithDiscrepancy" statusCode="11" description="Envío procesado y con discrepancias"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-DuplicateNotProcessed" statusCode="12" description="Envío Duplicado No Procesado"/>
            <moqui.basic.StatusItem statusTypeId="DteEnvio" statusId="Ftde-Cancelled" statusCode="13" description="Envío Cancelado"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Created" toStatusId="Ftde-Sent"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Created" toStatusId="Ftde-Failed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Created" toStatusId="Ftde-Cancelled"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-Processed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessedWithRejection"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessedWithDiscrepancy"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessFailed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessRejectedSchema"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessRejectedSignature"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-ProcessRejectedEnvelope"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Received" toStatusId="Ftde-DuplicateNotProcessed"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-ProcessFailed" toStatusId="Ftde-Received"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Sent" toStatusId="Ftde-FailedAtReceiver"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-FailedAtReceiver" toStatusId="Ftde-Created"/>
            <moqui.basic.StatusFlowTransition statusFlowId="Default" statusId="Ftde-Sent" toStatusId="Ftde-Processed"/>
        </seed-data>
    </entity>
    
    <entity entity-name="RCof" package="mchile.dte">
        <field name="envioId" type="id" is-pk="true"/>
        <field name="fechaInicio" type="date"/>
        <field name="fechaFin" type="date"/>
        <relationship type="one" related="mchile.dte.DteEnvio">
            <key-map field-name="envioId"/>
        </relationship>
    </entity>

    <entity entity-name="DteEnvioFiscalTaxDocument" package="mchile.dte">
        <field name="envioId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id" is-pk="true"/>
        <relationship type="one" related="mchile.dte.DteEnvio"/>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument"/>
    </entity>

    <entity entity-name="FiscalTaxDocumentAttributes" package="mchile.dte">
        <field name="fiscalTaxDocumentId" type="id" is-pk="true"/>
        <field name="amount" type="number-decimal"/>
        <field name="emailEmisor" type="text-medium"/>
        <field name="montoNeto" type="number-decimal"/>
        <field name="tasaImpuesto" type="number-decimal"/>
        <field name="tipoImpuesto" type="number-decimal"/>
        <field name="razonSocialEmisor" type="text-medium"/>
        <field name="razonSocialReceptor" type="text-medium"/>
        <field name="fechaEmision" type="date"/>
        <field name="fechaVencimiento" type="date"/>
        <field name="fechaRecepcionSii" type="date-time"/>
        <field name="fechaLimiteAccionSii" type="date-time"/>
        <field name="fechaAcuseRecibo" type="date-time"/>
        <field name="documentoAnulado" type="text-medium"/>
        <field name="montoExento" type="number-decimal"/>
        <field name="montoIVARecuperable" type="number-decimal"/>
        <field name="codigoIVANoRecuperable" type="text-short"/>
        <field name="montoIVANoRecuperable" type="number-decimal"/>
        <field name="montoIVAUsoComun" type="number-decimal"/>
        <field name="codigoOtroImpuestoORetencion" type="text-medium"/>
        <field name="tasaOtroImpuestoORetencion" type="number-decimal"/>
        <field name="montoOtroImpuestoORetencionConCredito" type="number-decimal"/>
        <field name="montoOtroImpuestoORetencionSinCredito" type="number-decimal"/>
        <field name="montoNetoActivoFijo" type="number-decimal"/>
        <field name="montoIVAActivoFijo" type="number-decimal"/>
        <field name="montoIVANoRetenido" type="number-decimal"/>
        <field name="codigoSucursal" type="text-medium"/>
        <field name="notasDebitoCreditoFacturasCompra" type="text-medium"/>
        <field name="anulaBoleta" type="text-medium"/>
        <field name="folioAnulaBoleta" type="number-integer"/>
        <field name="dhdrCodigoSii" type="text-medium"><description>Código interno del SII para obtener detalles del SII sobre el DTE</description></field>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument" title="FiscalTaxDocumentId">
            <key-map field-name="fiscalTaxDocumentId"/>
        </relationship>
    </entity>

    <entity entity-name="PartyDteParams" package="mchile.dte">
        <field name="partyId" type="id" is-pk="true"/>
        <field name="templatePdf" type="text-medium"/>
        <field name="templatePdfBoleta" type="text-medium"/>
        <field name="templatePdfBoletaContinua" type="text-medium"/>
        <field name="logo" type="text-medium"/>
        <field name="fechaResolucionSii" type="text-medium"/>
        <field name="numeroResolucionSii" type="text-medium"/>
        <field name="razonSocialEmisor" type="text-medium"/>
        <field name="codigoSucursalSii" type="text-medium"/>
        <field name="oficinaSII" type="text-medium"/>
        <field name="direccionOrigen" type="text-medium"/>
        <field name="comunaOrigen" type="text-medium"/>
        <field name="ciudadOrigen" type="text-medium"/>
        <field name="certData" type="text-very-long" encrypt="true"><description>Base64-encoded X509 certificate in PKCS12 format</description></field>
        <field name="passCert" type="text-medium" encrypt="true"/>
        <field name="nombreContacto" type="text-medium"/>
        <field name="mailContacto" type="text-medium"/>
        <field name="fonoContacto" type="text-medium"/>
        <field name="pdfTemplate" type="text-very-long"/>
        <field name="pdfTemplateBoleta" type="text-very-long"/>
        <field name="pdfTemplateBoletaContinua" type="text-very-long"/>
        <field name="showItemNumber" type="text-indicator"/>
        <field name="commentAfterDetalle" type="text-very-long"/>
        <field name="cuentaBancariaMail" type="text-medium"/>
        <field name="cuentaBancariaText" type="text-very-long"/>
        <field name="codigosActividadEconomica" type="text-medium"><description>Códigos de Actividades Económicas registradas en el SII, máximo 4</description></field>
        <field name="detailHeaderBgColor" type="text-short"/>
        <field name="detailHeaderFgColor" type="text-short"/>
        <field name="detailHeaderSepColor" type="text-short"/>
        <field name="tableBorderColor" type="text-short"/>
        <field name="vendorNameColor" type="text-short"/>
        <field name="tokenBoleta" type="text-short"/>
        <field name="tokenBoletaLastUsage" type="date-time"/>
        <relationship type="one" related="mantle.party.Party" title="PartyId">
            <key-map field-name="partyId"/>
        </relationship>
    </entity>

    <entity entity-name="PartyGiro" package="mchile.dte">
        <field name="giroId" type="id" is-pk="true"/>
        <field name="partyId" type="id"/>
        <field name="isPrimary" type="text-short"/>
        <field name="description" type="text-medium" not-null="true"/>
        <relationship type="one" related="mantle.party.Party" title="PartyId" short-alias="party">
            <key-map field-name="partyId"/>
        </relationship>
    </entity>

    <extend-entity entity-name="Party" package="mantle.party">
        <relationship type="many" related="mchile.dte.PartyGiro" title="Giro" short-alias="giros">
            <key-map field-name="partyId"/>
        </relationship>
    </extend-entity>

    <view-entity entity-name="FiscalTaxDocumentAndAttributes" package="mchile.dte">
        <member-entity entity-alias="DTE" entity-name="mchile.dte.FiscalTaxDocument"/>
        <member-entity entity-alias="ATT" entity-name="mchile.dte.FiscalTaxDocumentAttributes" join-from-alias="DTE" join-optional="true">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <alias-all entity-alias="DTE"/>
        <alias-all entity-alias="ATT">
            <exclude field="fiscalTaxDocumentId"/>
        </alias-all>
    </view-entity>

    <view-entity entity-name="FiscalTaxDocumentAndContent" package="mchile.dte">
        <member-entity entity-alias="DTE" entity-name="mchile.dte.FiscalTaxDocument"/>
        <member-entity entity-alias="CONT" entity-name="mchile.dte.FiscalTaxDocumentContent" join-from-alias="DTE" join-optional="true">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <alias-all entity-alias="DTE"/>
        <alias-all entity-alias="CONT"/>
    </view-entity>

    <view-entity entity-name="FiscalTaxDocumentAndInvoice" package="mchile.dte">
        <member-entity entity-name="mchile.dte.FiscalTaxDocument" entity-alias="DTE"/>
        <member-entity entity-name="mchile.dte.FiscalTaxDocumentAttributes" join-from-alias="DTE" entity-alias="DTEATTR" join-optional="true">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <member-entity entity-alias="INV" entity-name="mantle.account.invoice.Invoice" join-from-alias="DTE" join-optional="true">
            <key-map field-name="invoiceId"/>
        </member-entity>
        <alias-all entity-alias="DTE">
            <exclude field="statusId"/>
        </alias-all>
        <alias-all entity-alias="DTEATTR" prefix="dte"/>
        <alias-all entity-alias="INV">
            <exclude field="statusId"/>
        </alias-all>
        <alias name="fiscalTaxDocumentStatusId" entity-alias="DTE" field="statusId"/>
        <alias name="invoiceStatusId" entity-alias="INV" field="statusId"/>
    </view-entity>

    <view-entity entity-name="DteEnvioAndFiscalTaxDocument" package="mchile.dte">
        <member-entity entity-name="mchile.dte.DteEnvioFiscalTaxDocument" entity-alias="DEFTD"/>
        <member-entity entity-alias="DE" entity-name="mchile.dte.DteEnvio" join-from-alias="DEFTD">
            <key-map field-name="envioId"/>
        </member-entity>
        <member-entity entity-alias="FTD" entity-name="mchile.dte.FiscalTaxDocument" join-from-alias="DEFTD">
            <key-map field-name="fiscalTaxDocumentId"/>
        </member-entity>
        <alias-all entity-alias="DE">
            <exclude field="statusId"/>
            <exclude field="trackId"/>
            <exclude field="issuerPartyId"/>
            <exclude field="receiverPartyId"/>
        </alias-all>
        <alias-all entity-alias="FTD">
            <exclude field="statusId"/>
            <exclude field="trackId"/>
            <exclude field="issuerPartyId"/>
            <exclude field="receiverPartyId"/>
        </alias-all>
        <alias name="envioStatusId" entity-alias="DE" field="statusId"/>
        <alias name="envioTrackId" entity-alias="DE" field="trackId"/>
        <alias name="envioIssuerPartyId" entity-alias="DE" field="issuerPartyId"/>
        <alias name="envioReceiverPartyId" entity-alias="DE" field="receiverPartyId"/>
        <alias name="ftdTrackId" entity-alias="FTD" field="trackId"/>
        <alias name="ftdStatusId" entity-alias="FTD" field="statusId"/>
        <alias name="ftdIssuerPartyId" entity-alias="FTD" field="issuerPartyId"/>
        <alias name="ftdReceiverPartyId" entity-alias="FTD" field="receiverPartyId"/>
    </view-entity>

    <extend-entity entity-name="InvoiceItem" package="mantle.account.invoice">
        <field name="dteQuantity" type="number-decimal">
            <description>Quantity received in DTE (where the detail amount is rounded so does not necessarily match quantity*amount)</description>
        </field>
        <field name="dteAmount" type="currency-precise">
            <description>Amount (unit price) received in DTE (where the detail amount is rounded so does not ncessarily match quantity*amount)</description>
        </field>
    </extend-entity>

    <view-entity entity-name="PartyDteParamsAndPartyDetail" package="mchile.dte">
        <member-entity entity-alias="PDP" entity-name="mchile.dte.PartyDteParams"/>
        <member-entity entity-alias="PTY" entity-name="mantle.party.Party" join-from-alias="PDP">
            <key-map field-name="partyId"/>
        </member-entity>
        <member-entity entity-alias="ORG" entity-name="mantle.party.Organization" join-from-alias="PDP" join-optional="true">
            <key-map field-name="partyId"/>
        </member-entity>
        <member-entity entity-alias="PRS" entity-name="mantle.party.Person" join-from-alias="PDP" join-optional="true">
            <key-map field-name="partyId"/>
        </member-entity>
        <alias-all entity-alias="PDP"/>
        <alias-all entity-alias="PTY"/>
        <alias-all entity-alias="ORG"/>
        <alias-all entity-alias="PRS"/>
    </view-entity>

    <entity entity-name="DteFactoringAssignment" package="mchile.dte">
        <field name="factoringAssignmentId" type="id" is-pk="true"/>
        <field name="statusId" type="id" default="DfaActive"/>
        <field name="processingStatusId" type="id" default="Dfap"/>
        <field name="assignmentDate" type="date-time" not-null="true"/>
        <field name="fiscalTaxDocumentId" type="id" not-null="true"/>
        <field name="assignmentSeqNumber" type="number-integer"><description>Número de 1 a 40</description></field>
        <field name="assignorPartyId" type="id"/>
        <field name="assignorPartyIdValue" type="id" not-null="true"/>
        <field name="assignorName" type="text-medium" not-null="true"/>
        <field name="assigneePartyId" type="id"/>
        <field name="assigneePartyIdValue" type="id" not-null="true"/>
        <field name="assigneeName" type="text-short"/>
        <field name="assigneeAddress" type="text-short"/>
        <field name="assigneeEmail" type="text-short"/>
        <field name="assignmentAmount" type="number-decimal"/>
        <field name="debtorEmail" type="text-short"/>
        <field name="assignorEmail" type="text-short"/>
        <field name="assignmentInfoKey" type="text-short"><description>Código entregado por el SII al momento de la asignación, permite a terceros acceso a información sobre la cesión</description></field>
        <field name="lastDueDate" type="date"/>
        <field name="otherConditions" type="text-medium"/>
        <relationship type="one" related="mchile.dte.FiscalTaxDocument"/>
        <relationship type="one" related="moqui.basic.StatusItem" title="DteFactoringAssignment"/>
        <relationship type="one" related="moqui.basic.StatusItem" title="DteFactoringAssignmentProcessing">
            <key-map field-name="processingStatusId"/>
        </relationship>
        <relationship type="one" related="mantle.party.Party" fk-name="AssignorPartyId" short-alias="asignor">
            <key-map field-name="assignorPartyId" related="partyId"/>
        </relationship>
        <relationship type="one" related="mantle.party.Party" fk-name="AssigneePartyId" short-alias="asignee">
            <key-map field-name="assigneePartyId" related="partyId"/>
        </relationship>
        <seed-data>
            <moqui.basic.StatusType statusTypeId="DteFactoringAssignment" description="Status of Dte Factoring Assignment"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignment" statusId="DfaInProcess" sequenceNum="1" description="In process of being assigned"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignment" statusId="DfaActive" sequenceNum="2" description="Active"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignment" statusId="DfaReassigned" sequenceNum="3" description="Has been reassigned to another assignee"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignment" statusId="DfaCancelled" sequenceNum="4" description="Cancelled"/>
            <moqui.basic.StatusType statusTypeId="DteFactoringAssignmentProcessing" description="Status of processing Dte Factoring Assignment"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignmentProcessing" statusId="DfapNotProcessed" sequenceNum="1" description="Not (yet) processed"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignmentProcessing" statusId="DfapProcessed" sequenceNum="2" description="Not (yet) processed"/>
            <moqui.basic.StatusItem statusTypeId="DteFactoringAssignmentProcessing" statusId="DfapFailedToProcess" sequenceNum="3" description="Processing failed"/>
        </seed-data>
    </entity>

    <entity entity-name="DteFactoringAssignmentSignature" package="mchile.dte">
        <field name="factoringAssignmentId" type="id" is-pk="true"/>
        <field name="signatureSeqId" type="id" is-pk="true"/>
        <field name="idValue" type="id" not-null="true"/>
        <field name="name" type="text-medium" not-null="true"/>
        <relationship type="one" related="mchile.dte.DteFactoringAssignment"/>
    </entity>

</entities>

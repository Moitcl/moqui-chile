<?xml version="1.0" encoding="UTF-8"?>
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-2.1.xsd">

    <entity entity-name="FiscalTaxDocument" package="mch.dte">
        <field name="fiscalTaxDocumentId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="id" is-pk="true"/>
        <field name="date" type="date-time" default="ec.user.nowTimestamp"/>
        <field name="invoiceId" type="id"/>
        <field name="amount" type="number-decimal"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="mantle.account.invoice.Invoice">
            <key-map field-name="invoiceId"/>
        </relationship>

        <seed-data>
            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentType" description="Fiscal Tax Documents"/>
            <!-- Source: http://www.sii.cl/factura_electronica/formato_iecv.pdf, http://www.sii.cl/factura_electronica/formato_dte.pdf
             -->
            <moqui.basic.EnumerationType enumTypeId="FiscalTaxDocumentType" description="Fiscal Tax Documents"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-DTE" description="Documento Tributario Electrónico"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-DT" description="Documento Tributario (soporte papel)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-29" enumCode="29" sequenceNum="29" parentEnumId="Ftdt-DT" description="Factura de Inicio"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-30" enumCode="30" sequenceNum="30" parentEnumId="Ftdt-DT" description="Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-32" enumCode="32" sequenceNum="32" parentEnumId="Ftdt-DT" description="Factura de Ventas y Servicios no Afectos a IVA"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-33" enumCode="33" sequenceNum="33" parentEnumId="Ftdt-DTE" description="Factura Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-34" enumCode="34" sequenceNum="34" parentEnumId="Ftdt-DTE" description="Factura Exenta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-35" enumCode="35" sequenceNum="35" parentEnumId="Ftdt-DT" description="Boleta"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-38" enumCode="38" sequenceNum="38" parentEnumId="Ftdt-DT" description="Boleta Exenta"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-39" enumCode="39" sequenceNum="39" parentEnumId="Ftdt-DTE" description="Boleta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-40" enumCode="40" sequenceNum="40" parentEnumId="Ftdt-DT" description="Liquidación Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-41" enumCode="41" sequenceNum="41" parentEnumId="Ftdt-DTE" description="Boleta Exenta Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-43" enumCode="43" sequenceNum="43" parentEnumId="Ftdt-DTE" description="Liquidación Factura Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-45" enumCode="45" sequenceNum="45" parentEnumId="Ftdt-DT" description="Factura de Compra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-46" enumCode="46" sequenceNum="46" parentEnumId="Ftdt-DTE" description="Factura de Compra Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-50" enumCode="50" sequenceNum="50" parentEnumId="Ftdt-DT" description="Guía de Despacho"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-52" enumCode="52" sequenceNum="52" parentEnumId="Ftdt-DTE" description="Guía de Despacho Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-55" enumCode="55" sequenceNum="55" parentEnumId="Ftdt-DT" description="Nota de Débito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-56" enumCode="56" sequenceNum="56" parentEnumId="Ftdt-DTE" description="Nota de Débito Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-60" enumCode="60" sequenceNum="60" parentEnumId="Ftdt-DT" description="Nota de Crédito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-61" enumCode="61" sequenceNum="61" parentEnumId="Ftdt-DTE" description="Nota de Crédito Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-101" enumCode="101" sequenceNum="101" parentEnumId="Ftdt-DT" description="Factura de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-102" enumCode="102" sequenceNum="102" parentEnumId="Ftdt-DT" description="Factura de venta exenta a zona franca primaria"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-103" enumCode="103" sequenceNum="103" parentEnumId="Ftdt-DT" description="Liquidación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-104" enumCode="104" sequenceNum="104" parentEnumId="Ftdt-DT" description="Nota de débito de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-105" enumCode="105" sequenceNum="105" parentEnumId="Ftdt-DT" description="Boleta liquidación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-106" enumCode="106" sequenceNum="106" parentEnumId="Ftdt-DT" description="Nota de Crédito de exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-108" enumCode="108" sequenceNum="108" parentEnumId="Ftdt-DT" description="SRF Solicitud de Registro de Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-109" enumCode="109" sequenceNum="109" parentEnumId="Ftdt-DT" description="Factura a turista"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-110" enumCode="110" sequenceNum="110" parentEnumId="Ftdt-DTE" description="Factura de Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-111" enumCode="111" sequenceNum="111" parentEnumId="Ftdt-DTE" description="Nota de Débito Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-112" enumCode="112" sequenceNum="112" parentEnumId="Ftdt-DTE" description="Nota de Crédito Exportación Electrónica"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-801" enumCode="801" sequenceNum="801" parentEnumId="Ftdt-DT" description="Orden de Compra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-802" enumCode="802" sequenceNum="802" parentEnumId="Ftdt-DT" description="Nota de Pedido"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-803" enumCode="803" sequenceNum="803" parentEnumId="Ftdt-DT" description="Contrato"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-804" enumCode="804" sequenceNum="804" parentEnumId="Ftdt-DT" description="Resolución"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-805" enumCode="805" sequenceNum="805" parentEnumId="Ftdt-DT" description="Proceso ChileCompra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-806" enumCode="806" sequenceNum="806" parentEnumId="Ftdt-DT" description="Ficha ChileCompra"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-807" enumCode="807" sequenceNum="807" parentEnumId="Ftdt-DT" description="DUS"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-808" enumCode="808" sequenceNum="808" parentEnumId="Ftdt-DT" description="B/L (Conocimiento de embarque)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-809" enumCode="809" sequenceNum="809" parentEnumId="Ftdt-DT" description="AWB (Air Will Bill)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-810" enumCode="810" sequenceNum="810" parentEnumId="Ftdt-DT" description="MIC/DTA"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-811" enumCode="811" sequenceNum="811" parentEnumId="Ftdt-DT" description="Carta de Porte"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-812" enumCode="812" sequenceNum="812" parentEnumId="Ftdt-DT" description="Resolución del SNA donde califica Servicios de Exportación"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-813" enumCode="813" sequenceNum="813" parentEnumId="Ftdt-DT" description="Pasaporte"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-814" enumCode="814" sequenceNum="814" parentEnumId="Ftdt-DT" description="Certificado de Depósito Bolsa Prod. Chile"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-815" enumCode="815" sequenceNum="815" parentEnumId="Ftdt-DT" description="Vale de Prenda Bolsa Prod. Chile"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-901" enumCode="901" sequenceNum="901" parentEnumId="Ftdt-DT" description="Factura de Ventas a Empresas del Territorio Preferencial"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-902" enumCode="902" sequenceNum="902" parentEnumId="Ftdt-DT" description="Conocimiento de Embarque (Marítimo o aéreo)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-903" enumCode="903" sequenceNum="903" parentEnumId="Ftdt-DT" description="Documento único de Salida (DUS)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-904" enumCode="904" sequenceNum="904" parentEnumId="Ftdt-DT" description="Factura de Traspaso (Zona Franca)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-905" enumCode="905" sequenceNum="905" parentEnumId="Ftdt-DT" description="Factura de Reexpedición"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-906" enumCode="906" sequenceNum="906" parentEnumId="Ftdt-DT" description="Boleta Venta Módulos ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-907" enumCode="907" sequenceNum="907" parentEnumId="Ftdt-DT" description="Factura Venta Módulos ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-909" enumCode="909" sequenceNum="909" parentEnumId="Ftdt-DT" description="Factura Venta Módulo ZF"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-910" enumCode="910" sequenceNum="910" parentEnumId="Ftdt-DT" description="Solicitud Traslado Zona Franca"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-911" enumCode="911" sequenceNum="911" parentEnumId="Ftdt-DT" description="Declaración de Ingreso a Zona Franca Primaria"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-914" enumCode="914" sequenceNum="914" parentEnumId="Ftdt-DT" description="Declaración de Ingreso (DIN)"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-919" enumCode="919" sequenceNum="919" parentEnumId="Ftdt-DT" description="Resumen de ventas de nacionales pasajes sin Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-920" enumCode="920" sequenceNum="920" parentEnumId="Ftdt-DT" description="Otros registros no documentados Aumenta débito"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-922" enumCode="922" sequenceNum="922" parentEnumId="Ftdt-DT" description="Otros registros. Disminuye débito."/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-924" enumCode="924" sequenceNum="924" parentEnumId="Ftdt-DT" description="Resumen ventas de internacionales pasajes sin Factura"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-LibroCompras" sequenceNum="240" description="Libro de Compras"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="Ftdt-LibroVentas" sequenceNum="240" description="Libro de Ventas"/>
            <moqui.basic.Enumeration enumTypeId="FiscalTaxDocumentType" enumId="PvtRedcompra" sequenceNum="30" description="Comprobante Redcompra válido como boleta"/>
        </seed-data>
    </entity>

    <entity entity-name="Caf" package="mch.dte" cache="never" >
        <field name="cafId" type="id" is-pk="true"/>
        <field name="activo" type="text-short"/>
        <field name="filename" type="text-medium"/>
        <field name="desde" type="number-integer"/>
        <field name="hasta" type="number-integer"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="fechaAutorizacion" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="ultimoFolio" type="number-integer"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
    </entity>

    <!-- Entidad para guardar referencias asociadas a Returns, usadas para generar notas de crédito -->
    <entity entity-name="ReferenciaReturn" package="mch.dte" cache="never" >
        <field name="referenciaReturnId" type="id" is-pk="true"/>
        <field name="returnId" type="id"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="codigoReferenciaEnumId" type="text-short"/>
        <field name="razonReferencia" type="text-medium"/>
        <field name="fecha" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="idAdicional" type="text-medium"/>
        <field name="folio" type="text-short"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" title="CodigoReferencia">
            <key-map field-name="codigoReferenciaEnumId"/>
        </relationship>
        <relationship type="one" related="mantle.order.return.ReturnHeader" title="ReturnId">
            <key-map field-name="returnId"/>
        </relationship>

        <seed-data>
            <moqui.basic.EnumerationType enumTypeId="CodigoReferencia" description="Códigos de Referencia"/>
            <moqui.basic.Enumeration enumTypeId="CodigoReferencia" enumId="1" sequenceNum="10" description="Anula Doc. de Referencia"/>
            <moqui.basic.Enumeration enumTypeId="CodigoReferencia" enumId="2" sequenceNum="20" description="Corrige Texto de Referencia"/>
            <moqui.basic.Enumeration enumTypeId="CodigoReferencia" enumId="3" sequenceNum="30" description="Corrige Montos"/>
        </seed-data>
    </entity>

    <!-- Entidad para guardar referencias asociadas a invoices, usadas para generar Facturas -->
    <entity entity-name="ReferenciaInvoice" package="mch.dte" cache="never" >
        <field name="referenciaInvoiceId" type="id" is-pk="true"/>
        <field name="invoiceId" type="id"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="codigoReferenciaEnumId" type="text-short"/>
        <field name="razonReferencia" type="text-medium"/>
        <field name="fecha" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="idAdicional" type="text-medium"/>
        <field name="folio" type="text-short"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" title="CodigoReferencia">
            <key-map field-name="codigoReferenciaEnumId"/>
        </relationship>
        <relationship type="one" related="mantle.account.invoice.Invoice" title="InvoiceId">
            <key-map field-name="invoiceId"/>
        </relationship>
    </entity>

    <!-- Entidad para guardar referencias de facturas -->
    <entity entity-name="ReferenciaFactura" package="mch.dte" cache="never" >
        <field name="referenciaFacturaId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="codigoReferenciaEnumId" type="text-short"/>
        <field name="razonReferencia" type="text-medium"/>
        <field name="fecha" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="idAdicional" type="text-medium"/>
        <field name="folio" type="text-short"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="FiscalTaxDocumentType">
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
        <relationship type="one" related="moqui.basic.Enumeration" title="CodigoReferencia">
            <key-map field-name="codigoReferenciaEnumId"/>
        </relationship>
        <relationship type="one" related="mch.dte.FiscalTaxDocument" title="FiscalTaxDocumentId">
            <key-map field-name="fiscalTaxDocumentId"/>
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
    </entity>

    <!-- Entidad para guardar referencias a facturas, usadas para generar Notas de Débito -->
    <entity entity-name="ReferenciaNotaDebito" package="mch.dte" cache="never" >
        <field name="referenciaNotaDebitoId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="text-short"/>
        <field name="codigoReferenciaEnumId" type="text-short"/>
        <field name="razonReferencia" type="text-medium"/>
        <field name="fecha" type="date"/>
        <field name="rut" type="text-medium"/>
        <field name="idAdicional" type="text-medium"/>
        <field name="folio" type="text-short"/>
        <relationship type="one" related="moqui.basic.Enumeration" title="CodigoReferencia">
            <key-map field-name="codigoReferenciaEnumId"/>
        </relationship>
        <relationship type="one" related="mch.dte.FiscalTaxDocument" title="FiscalTaxDocumentId">
            <key-map field-name="fiscalTaxDocumentId"/>
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
    </entity>

    <!-- Entidad para guardar respuestas a DTE terceros, implementado uno a uno -->
    <entity entity-name="AceptacionDte" package="mch.dte" cache="never" >
        <field name="aceptacionDteId" type="id" is-pk="true"/>
        <field name="fiscalTaxDocumentId" type="id"/>
        <field name="fiscalTaxDocumentTypeEnumId" type="id"/>
        <field name="rutResponde" type="text-medium"/>
        <field name="rutRecibe" type="text-medium"/>
        <field name="nroDetalles" type="number-integer"/>
        <field name="nmbContacto" type="text-medium"/>
        <field name="fonoContacto" type="text-medium"/>
        <field name="mailContacto" type="text-medium"/>
        <field name="nmbEnvio" type="text-medium"/>
        <field name="fchRecep" type="text-medium"/>
        <field name="codEnvio" type="text-medium"/>
        <field name="envioDteId" type="text-medium"/>
        <field name="rutEmisor" type="text-medium"/>
        <field name="rutReceptor" type="text-medium"/>
        <field name="estadoRecepEnvEnumId" type="text-medium"/>
        <field name="xml" type="text-medium"/>

        <relationship type="one" related="mch.dte.FiscalTaxDocument" title="FiscalTaxDocumentId">
            <key-map field-name="fiscalTaxDocumentId"/>
            <key-map field-name="fiscalTaxDocumentTypeEnumId"/>
        </relationship>
    </entity>

</entities>